<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Manage Products</h2>
        
        <div id="productList" class="row"></div>

        <h3>Add New Product</h3>
        <form id="productForm">
            <div class="form-group">
                <label for="productName">Product Name:</label>
                <input type="text" class="form-control" id="productName" required>
            </div>
            <div class="form-group">
                <label for="productDescription">Description:</label>
                <input type="text" class="form-control" id="productDescription" required>
            </div>
            <div class="form-group">
                <label for="productPrice">Price:</label>
                <input type="number" class="form-control" id="productPrice" required>
            </div>
            <div class="form-group">
                <label for="productStock">Stock:</label>
                <input type="number" class="form-control" id="productStock" required>
            </div>
            <div class="form-group">
                <label for="productImage">Image URL:</label>
                <input type="text" class="form-control" id="productImage" required>
            </div>
            <div class="form-group">
                <label for="productCategory">Category:</label>
                <input type="text" class="form-control" id="productCategory" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
    </div>

    <script>
        // Fetch and display products
        async function fetchProducts() {
            const response = await fetch('/api/products');
            if (response.ok) {
                const products = await response.json();
                const productList = document.getElementById('productList');
                productList.innerHTML = '';
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'col-md-3';
                    productCard.innerHTML = `
                        <div class="product-card">
                            <h5>${product.name}</h5>
                            <p>${product.description}</p>
                            <p>Price: $${product.price.toFixed(2)}</p>
                            <button onclick="deleteProduct(${product.id})" class="btn btn-danger">Delete</button>
                        </div>
                    `;
                    productList.appendChild(productCard);
                });
            }
        }

        // Delete product
        async function deleteProduct(productId) {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'DELETE'
            });
            fetchProducts(); // Refresh product list
        }

        // Handle form submission for adding a new product
        document.getElementById('productForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const name = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const imageUrl = document.getElementById('productImage').value;
            const category = document.getElementById('productCategory').value;

            const productData = {
                name,
                description,
                price,
                stock,
                imageUrl,
                category
            };

            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });

                if (response.ok) {
                    fetchProducts(); // Refresh product list
                    document.getElementById('productForm').reset();
                } else {
                    const error = await response.text();
                    alert(`Error: ${error}`);
                }
            } catch (error) {
                alert(`Unexpected error: ${error.message}`);
            }
        });

        // Load products when page loads
        window.onload = fetchProducts;
    </script>
</body>
</html>
